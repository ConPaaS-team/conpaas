#!/bin/bash

. /etc/ec2/params

export SOURCE=
export EC2_USER=
export EC2_PASSWORD=
export PUBLIC_IP=$EC2_PUBLIC_IP

wget -P /root/ $SOURCE/ConPaaSWeb.tar.gz
wget -P /root/ $SOURCE/manager-start
wget -P /root/ $SOURCE/ec2-agent-user-data

cat <<EOF > /root/config.cfg
[iaas]
DRIVER = EC2

## EC2
EC2_USER = $EC2_USER
EC2_PASSWORD = $EC2_PASSWORD
EC2_IMAGE_ID = ami-5fc70136
EC2_SIZE_ID = t1.micro
EC2_SECURITY_GROUP_NAME = contrail
EC2_KEY_NAME = contrail
EC2_AGENT_USERDATA = /root/ec2-agent-user-data

[manager]
TYPE = %CONPAAS_SERVICE_TYPE%
BOOTSTRAP = $SOURCE
MEMCACHE_ADDR = 127.0.0.1:11211

ROOT = 
LOG_FILE = %(ROOT)s/var/log/cpsmanager.web.log
ETC = %(ROOT)s/etc/cpsmanager.web/
VAR_TMP = %(ROOT)s/var/tmp/cpsmanager.web/
VAR_CACHE = %(ROOT)s/var/cache/cpsmanager.web/
VAR_RUN = %(ROOT)s/var/run/cpsmanager.web/
CODE_REPO = %(VAR_CACHE)s/code_repo
FE_SERVICE_ID = %CONPAAS_SERVICE_ID%
FE_CREDIT_URL = PATH_TO/callback/decrementUserCredit.php
FE_TERMINATE_URL = PATH_TO/callback/terminateService.php
EOF


chmod 755 /root/manager-start
/root/manager-start
