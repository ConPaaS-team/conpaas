#!/bin/bash

if [ -f /mnt/context.sh ]; then
  . /mnt/context.sh
fi

/sbin/ifconfig eth0 $IP_PUBLIC
/sbin/ip route add default via $IP_GATEWAY
echo "nameserver $NAMESERVER" > /etc/resolv.conf

SOURCE=

wget -P /root/ $SOURCE/ConPaaSWeb.tar.gz
wget -P /root/ $SOURCE/manager-start
wget -P /root/ $SOURCE/opennebula-agent-user-data


cat <<EOF > /root/config.cfg
[iaas]
DRIVER = OPENNEBULA

## OPENNEBULA
OPENNEBULA_URL = 
OPENNEBULA_USER = 
OPENNEBULA_PASSWORD = 
OPENNEBULA_IMAGE_ID = 
OPENNEBULA_SIZE_ID = 
OPENNEBULA_NETWORK_ID = 
OPENNEBULA_NETWORK_GATEWAY = 
OPENNEBULA_NETWORK_NAMESERVER = 
OPENNEBULA_AGENT_USERDATA = /root/opennebula-agent-user-data

[manager]
TYPE = %CONPAAS_SERVICE_TYPE%
BOOTSTRAP = $SOURCE
MEMCACHE_ADDR = 127.0.0.1:11211

ROOT = 
LOG_FILE = %(ROOT)s/var/log/cpsmanager.web.log
ETC = %(ROOT)s/etc/cpsmanager.web/
VAR_TMP = %(ROOT)s/var/tmp/cpsmanager.web/
VAR_CACHE = %(ROOT)s/var/cache/cpsmanager.web/
VAR_RUN = %(ROOT)s/var/run/cpsmanager.web/
CODE_REPO = %(VAR_CACHE)s/code_repo
FE_SERVICE_ID = %CONPAAS_SERVICE_ID%
FE_CREDIT_URL = PATH_TO/callback/decrementUserCredit.php
FE_TERMINATE_URL = PATH_TO/callback/terminateService.php
EOF


export PUBLIC_IP=$IP_PUBLIC

chmod 755 /root/manager-start
/root/manager-start

